%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OmniLaTeX Floats Module
%
% Float configuration, captions, and subfloats
% Part of OmniLaTeX-template modular architecture
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{lib/layout/omnilatex-floats}[2024-10-11 v6.0.0 OmniLaTeX floats module]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Float Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{flafter}% Floats always after their reference

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Caption Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{caption}
\RequirePackage{xparse}

% Will be printed between 'Figure/Table/... XYZ' and the caption text:
\DeclareCaptionLabelSeparator{slash}{\ /\ }% `\ ' (backslash+space) is a short space

\DeclareCaptionFont{ftfont}{%
    \scriptsize%
    \color{g3}%
    \hypersetup{hidelinks}%
    \sffamily\raggedleft%
}%

\captionsetup{% All captions
    format=plain,%
    textformat=period,% Always print period at end
    font=small,% All fonts
    labelfont={sf,bf},%
    labelsep=slash,%
    labelformat=simple,% Just Name/Number, no period or similar
    indention=1em,%
}%

\captionsetup[subfigure]{%
    labelformat=simple,% 'parens' uses parantheses, 'brace' just the right one
    labelsep=slash,%
    labelfont={sf,bf},%
    list=off,% list=off removes subfigures from LoF
}%

\captionsetup[subtable]{%
    labelformat=simple,% 'parens' uses parantheses, 'brace' just the right one
    labelsep=slash,%
    labelfont={sf,bf},%
    list=off,% list=off removes subfigures from LoF
}%

% Change counter from Arabic number to letter:
\renewcommand*{\theContinuedFloat}{\alph{ContinuedFloat}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Subfloats
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{subcaption}% For subfloats

\newlength{\omnilatex@floatboxwidth}
\setlength{\omnilatex@floatboxwidth}{0.5\linewidth}
\newcommand*{\FBwidth}{\omnilatex@floatboxwidth}

\NewDocumentEnvironment{subfloatrow}{O{2}}{%
    \begingroup
    \setlength{\omnilatex@floatboxwidth}{\dimexpr\linewidth/#1\relax}%
    \begin{minipage}{\linewidth}%
    \centering
}{%
    \end{minipage}%
    \endgroup
}

\NewDocumentCommand{\ffigbox}{O{\FBwidth} +m +m}{%
    \begin{minipage}{#1}%
        \centering
        #3\par
        #2%
    \end{minipage}%
}

\newcounter{omnilatex@mpfootnote}

\NewDocumentCommand{\mpfootnotemark}{o}{%
    \IfNoValueTF{#1}{%
        \stepcounter{omnilatex@mpfootnote}%
        \footnotemark[\value{omnilatex@mpfootnote}]%
    }{%
        \footnotemark[#1]%
    }%
}

\NewDocumentCommand{\mpfootnotetext}{o m}{%
    \IfNoValueTF{#1}{%
        \footnotetext[\value{omnilatex@mpfootnote}]{#2}%
    }{%
        \footnotetext[#1]{#2}%
    }%
}

\NewDocumentCommand{\ttabbox}{O{\FBwidth} +m +m}{%
    \setcounter{omnilatex@mpfootnote}{0}%
    \begin{minipage}{#1}%
        \centering
        #2\par
        #3%
    \end{minipage}%
}

\NewDocumentCommand{\floatbox}{m +m +m}{%
    #2\par
    #3%
}

\NewDocumentCommand{\floatfoot}{m}{%
    \caption*{#1}%
}

\NewDocumentCommand{\fcapside}{O{\FBwidth} +m +m}{%
    \begin{minipage}{\linewidth}%
        \begin{minipage}[t]{\dimexpr\linewidth-#1-1em\relax}%
            #2\par
        \end{minipage}\hfill
        \begin{minipage}[t]{#1}%
            \centering
            #3\par
        \end{minipage}%
    \end{minipage}%
}

\NewDocumentCommand{\fakeverb}{m}{%
    \begingroup
        \ttfamily
        \detokenize{#1}%
    \endgroup
}

\endinput
