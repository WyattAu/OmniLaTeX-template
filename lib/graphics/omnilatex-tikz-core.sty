%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OmniLaTeX TikZ Core Module
%
% TikZ/PGFPlots core configuration, libraries, and plot styles
% Part of OmniLaTeX-template modular architecture
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{lib/graphics/omnilatex-tikz-core}[2024-10-11 v6.0.0 OmniLaTeX TikZ core module]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Core TikZ and PGFPlots Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{pgfplots}% Also loads Tikz

% For advanced table calcs, e.g. 'y expr' to mathematically process input data:
\RequirePackage{pgfplotstable}

\RequirePackage[edges]{forest}% Comprehensive trees

\RequirePackage{tikz-3dplot}
\RequirePackage{circuitikz}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TikZ Libraries
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Only use libraries as needed to keep compilation times low
\usetikzlibrary{%
    positioning,% Relative positioning etc.
    calc,% Calculate distances, coordinates etc.
    shapes, % For cross out
    backgrounds,% Draw on background layer
    fit,% Fit new node around existing coordinates
    decorations,
    arrows,
    arrows.spaced,
    intersections,
    trees,
    circuits.ee.IEC,% Electrical engineering circuits lib
    patterns,
    3d,
    tikzmark,% Marks/coordinates at arbitrary positions
}%

\usepgfplotslibrary{%
    colorbrewer,%
    units,%
    dateplot,
    fillbetween,
    groupplots,
}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colour Cycle for Plots
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfplotscreateplotcyclelist{mod RdYlBu3}{% Modify existing colorbrewer
    {rdylbu2},
    {black!50},
    {rdylbu5}% No comma or space here!
}%

\pgfplotscreateplotcyclelist{mod mark list}{% Modify predefined to start without mark
every mark/.append style={solid,fill=\pgfplotsmarklistfill}\\
every mark/.append style={solid,fill=\pgfplotsmarklistfill},mark=*\\
every mark/.append style={solid,fill=\pgfplotsmarklistfill},mark=square*\\
every mark/.append style={solid,fill=\pgfplotsmarklistfill},mark=triangle*\\
every mark/.append style={solid},mark=star\\
every mark/.append style={solid,fill=\pgfplotsmarklistfill},mark=diamond*\\
every mark/.append style={solid,fill=\pgfplotsmarklistfill!40},mark=otimes*\\
every mark/.append style={solid},mark=|\\
every mark/.append style={solid,fill=\pgfplotsmarklistfill},mark=pentagon*\\
}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Global Plot Settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfplotstableset{col sep=comma}% If ALL files/tables are comma-separated

\pgfplotsset{%
    % Version this document was originally created with;
    % see also https://tex.stackexchange.com/a/81912/120853
    % Important for reproducibility
    compat=1.18,
    % In case nodes reach out of plot area, dont clip them off.
    % See: https://tex.stackexchange.com/a/127904/120853 and
    % https://tex.stackexchange.com/a/311194/120853
    clip mode=individual,
    label style={font=\small},% https://tex.stackexchange.com/a/300673/120853
    tick label style={%
            font=\small,%
            /pgf/number format/1000 sep={\,}% Small space instead of comma
        },
    cycle multi list={%
            mod mark list\nextlist% Just in case; likely never reached
            linestyles*\nextlist
            % Iterate through last one first; if at end,
            % start anew using next in parent (linestyles *):
            mod RdYlBu3%
        },%
    colormap/viridis,% For 3D/surf plots
    legend style={%
            at={(0.5,1.05)},% Center hor. (0.5), slightly out of drawing(>1 vert.)
            anchor=south,%
            legend columns=-1,% -1 means only rows, as many columns as required
            font=\footnotesize,%
            draw=none,% Do not draw box
            fill=none,% No white fill. Important for gray backgrounds
        },%
    % These comment lines (visual separation) are super important.
    % Empty lines will throw errors here!
    unit code/.code 2 args={\unit{#1#2}},% Use siunitx for units library
    unit markings={slash space},% The proper way... apparently?
    %
    % Fix micro unit display, see https://tex.stackexchange.com/a/224574/120853:
    x SI prefix/micro/.style={/pgfplots/axis base prefix={axis x base 6 prefix \micro}},
    y SI prefix/micro/.style={/pgfplots/axis base prefix={axis y base 6 prefix \micro}},
    z SI prefix/micro/.style={/pgfplots/axis base prefix={axis z base 6 prefix \micro}},
    %
    % Plot styles:
    regularplot/.style={% A broadly usable, regular plot
            ultra thick,
            axis line style=thick,
            ymajorgrids=true,
            xmajorgrids=true,
            grid style=dashed,
            axis lines=left,
            % scale only axis,% If off, labels are taken into account for size calculations
            ytick align=outside,% Puts ticks outside the plot itself
            xtick align=outside,%
            % Won't work if enlarge limits are invoked before 'axis lines left':
            enlargelimits=0.05,
        },%
    plainplot/.style={%
            % A clean, simple plot when numerical values and labels don't matter
            regularplot,
            xmajorgrids=false,
            ymajorgrids=false,
            ticks=none,% No ticks with numbers
        },
    tuftelike/.style={% https://tex.stackexchange.com/a/155210/120853
            axis line shift=10pt,% Also shifts label automatically
            try min ticks=3,% https://tex.stackexchange.com/a/95753/120853
            max space between ticks=50,% High number so ticks are far apart
            axis lines=left,
            ultra thick,
            axis line style = {semithick, -},% '-' suppresses arrow
            tick style = {semithick, black},%
            ytick align=inside,% Puts ticks inside the plot itself
            xtick align=inside,%
            xtick={%
                    % Always set min, max and middle ticks;
                    % if more desired, use 'extra x ticks={}'
                    \pgfkeysvalueof{/pgfplots/xmin},
                    \pgfkeysvalueof{/pgfplots/xmax},
                    (\pgfkeysvalueof{/pgfplots/xmax}+\pgfkeysvalueof{/pgfplots/xmin})/2
                },
            ytick={% Same as x
                    \pgfkeysvalueof{/pgfplots/ymin},
                    \pgfkeysvalueof{/pgfplots/ymax},
                    (\pgfkeysvalueof{/pgfplots/ymax}+\pgfkeysvalueof{/pgfplots/ymin})/2
                },
            clip = false,% https://tex.stackexchange.com/a/311194/120853
        },%
    % Unfortunately, decorations lib is relatively verbose:
    arrowplot/.style={
            decoration={
                    markings,
                    mark=at position 0.25 with {\arrow{#1}},
                    mark=at position 0.5 with {\arrow{#1}},
                    mark=at position 0.75 with {\arrow{#1}},
                },
            postaction=decorate,
        },
    %
    log x ticks with fixed point/.style={%
            % Logarithmic plot, but with linear labels instead of scientific notation
            % (10^2 becomes 100 etc.)
            % https://tex.stackexchange.com/a/139084/120853
            xticklabel={
                    \pgfkeys{/pgf/fpu=true}
                    \pgfmathparse{exp(\tick)}%
                    \pgfmathprintnumber[fixed relative, precision=3]{\pgfmathresult}
                    \pgfkeys{/pgf/fpu=false}
                }
        },
    %
    log y ticks with fixed point/.style={
            yticklabel={
                    \pgfkeys{/pgf/fpu=true}
                    \pgfmathparse{exp(\tick)}%
                    \pgfmathprintnumber[fixed relative, precision=3]{\pgfmathresult}
                    \pgfkeys{/pgf/fpu=false}
                }
        }
}

% Required in \tikset body for node placing at x style.
% Requires intersection lib
% https://tex.stackexchange.com/a/93968/120853
\def\parsenode[#1]#2\pgf@nil{%
    \tikzset{label node/.style={#1}}
\def\nodetext{#2}
}

\endinput
