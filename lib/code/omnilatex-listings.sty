%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OmniLaTeX Code Listings Module
%
% Source code highlighting with minted
% Part of OmniLaTeX-template modular architecture
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{lib/code/omnilatex-listings}[2024-10-11 v6.0.0 OmniLaTeX listings module]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Minted Package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Always enable caching for performance
% Cache directory is _minted-<jobname> by default
\RequirePackage[newfloat=true,cache=true,cachedir=_minted]{minted}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Minted Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setminted{%
    autogobble=true,
    fontsize=\footnotesize,
    breaklines=true,
    breakanywhere=true,
    escapeinside=¬¬,
    frame=leftline,
    framerule=1pt,
    rulecolor=\color{g3},
    numbers=left,
    numberfirstline=true,
    stepnumber=5,
    numbersep=2pt,
    style=manni,
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Listing Environment Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\SetupFloatingEnvironment{listing}{%
    name=\GetTranslation{Listing},
    listname=\GetTranslation{ListOfListings},
}

\newenvironment{longlisting}{\captionsetup{type=listing}}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Line Number Accessibility
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{accsupp}

\newcommand*{\emptyaccsupp}[1]{%
    \BeginAccSupp{ActualText={}}#1\EndAccSupp{}%
}%

\renewcommand*{\theFancyVerbLine}{%
    \textcolor{g3}{\ttfamily\tiny\emptyaccsupp{\arabic{FancyVerbLine}}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code Annotation Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand*{\phstring}[1]{%
    \textcolor{cRed}{#1}%
}%
\newcommand*{\phnum}[1]{%
    \textcolor{cBlue}{#1}%
}%
\newcommand*{\phother}[1]{%
    \textcolor{cGreen}{#1}%
}%
\newcommand*{\phnote}[1]{%
    {%
            \hypersetup{allcolors=cOrange}% If references occur in here
            \textbf{\textcolor{cOrange}{#1}}%
        }%
}%

\endinput
